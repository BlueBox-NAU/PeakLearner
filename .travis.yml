language: python

python:
  - 3.6
  - 3.7
  - 3.8

before_install:
  - sudo apt-get update
  - sudo apt-get -y install libdb5.3-dev
  - sudo apt-get -y install slurm-wlm
  # Setup python dependencies
  - python --version
  - pip install -U pip
  - pip install -U pytest
  - pip install requests
  - pip install pybbi
  - pip install pandas
  - pip install numpy
  - pip install bsddb3
  - pip install git+https://github.com/deltarod/PeakError.git
  - pip install codecov

script:
  # Setup slurm.conf for testing
  - sudo cp slurm.conf /etc/slurm-llnl
  - sudo service munge start
  - sudo systemctl restart slurmctld
  - sudo systemctl restart slurmd
  - sinfo
  # Test
  - pytest tests/

after_success:
  - codecov

after_failure:
  - sudo journalctl -u slurmctld
  - sudo journalctl -u slurmd




